{% extends 'AvanzuAdminThemeBundle:layout:base-layout.html.twig' %}

{% block page_content %}
    <div class="row">
    {% for budgettemplate in budgettemplates %}

        <div class="col-sm-6">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">{{ budgettemplate.name }}</h3>
                    <div class="box-tools pull-right">
                        <span class="label label-success" title="Positive Sum">{{ budgettemplate.positivesum|localizedcurrency('AUD') }}</span>
                        <span class="label label-default" title="Monthly to Fortnight">{{ (budgettemplate.positivesum*12/26)|localizedcurrency('AUD') }}</span>
                        <span class="label label-default" title="Fortnight to Monthly">{{ (budgettemplate.positivesum*26/12)|localizedcurrency('AUD') }}</span>
                        {% if budgettemplate.balance != 0 %}
                            <span class="label label-warning">{{ budgettemplate.balance|localizedcurrency('AUD') }}</span>
                        {% endif %}
                        <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="fa fa-minus"></i></button>

                    </div><!-- /.box-tools -->
                </div><!-- /.box-header -->
                <div class="box-body">
                    {% if budgettemplate.lastapplieddate %}Last applied {{ budgettemplate.lastapplieddate|date('Y-m-d') }}{% endif %}
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Description</th>
                            <th>Budget</th>
                            <th></th>
                            <th>Amount</th>
                        </tr>
                        </thead>
                    {% for templatetransaction in budgettemplate.templatetransactions %}
                        <tr>
                            <td>{{ templatetransaction.description }}</td>
                            <td><a href="{{ path('envelope_budgettransactions', {'accountid': templatetransaction.budgetaccount.id}) }}">{{ templatetransaction.budgetaccount.budgetname }}</a></td>
                            <td>
                                {% if templatetransaction.budgetaccount.balance <= 0 %}
                                    <span class="label label-warning">
                                {% else %}
                                    <span class="label label-default">
                                {% endif %}
                                {{ templatetransaction.budgetaccount.balance|localizedcurrency('AUD') }}</span>
                            </td>
                            <td align="right">{{ templatetransaction.amount|localizedcurrency('AUD') }}</td>
                        </tr>
                    {% endfor %}
                    </table>
                </div>
                <div class="box-footer">

                    {% for groupsum in budgettemplates_groupsums[budgettemplate.id] %}
                        {{ groupsum.name }}: {{ groupsum.total }}
                    {% endfor %}


                    <div class="box-tools pull-left">
                    <form action="{{ path('envelope_budget_template_clone', {'templateid': budgettemplate.id}) }}" method="post">
                        <a href="{{ path('envelope_budget_template_edit', {'id': budgettemplate.id}) }}" class="btn btn-default btn-box-tool">Edit Template</a> <button class="btn btn-default btn-box-tool">Clone Template</button>
                    </form>
                    </div>
                    <div class="box-tools pull-right">
                    <form action="{{ path('envelope_budget_template_delete', {'id': budgettemplate.id}) }}" method="post">
                        <button onclick="return confirm('Are you sure you want to delete this template?');" class="btn btn-danger btn-box-tool">Delete Template</button>
                    </form>
                        </div>

                </div><!-- box-footer -->
            </div><!-- /.box -->
        </div><!-- col -->

    {% endfor %}
    </div><!-- row -->
{% endblock %}